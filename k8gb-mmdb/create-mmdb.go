package main

import (
	"log"
	"net"
	"os"

	"github.com/maxmind/mmdbwriter"
	"github.com/maxmind/mmdbwriter/inserter"
	"github.com/maxmind/mmdbwriter/mmdbtype"
)

func main() {
	fh, err := os.Create("geoip.mmdb")
	if err != nil {
		log.Fatal(err)
	}
	defer fh.Close()

	writer, _ := mmdbwriter.New(
		mmdbwriter.Options{
			DatabaseType: "Test-IP-DB",
			RecordSize:   24,
			IPVersion:    4,
		},
	)

	usData := mmdbtype.Map{
		"datacenter": mmdbtype.String("us-west-2"),
	}
	for _, cidr := range cidrsUSWest2CIDRS {
		_, net, err := net.ParseCIDR(cidr)
		if err != nil {
			log.Fatal(err)
		}
		if err := writer.InsertFunc(net, inserter.TopLevelMergeWith(usData)); err != nil {
			log.Fatal(err)
		}
	}

	euData := mmdbtype.Map{
		"datacentre": mmdbtype.String("eu-west-1"),
	}
	for _, cidr := range cidrsEUWest1CIDRS {
		_, net, err := net.ParseCIDR(cidr)
		if err != nil {
			log.Fatal(err)
		}
		if err := writer.InsertFunc(net, inserter.TopLevelMergeWith(euData)); err != nil {
			log.Fatal(err)
		}
	}

	if _, err := writer.WriteTo(fh); err != nil {
		log.Fatal(err)
	}
}

var (
	cidrsUSWest2CIDRS = []string{
		"142.4.160.224/29",
		"142.4.160.56/29",
		"15.220.252.0/22",
		"3.2.40.0/25",
		"54.148.0.0/15",
		"99.77.130.0/24",
		"99.150.56.0/21",
		"15.220.207.0/24",
		"15.193.7.0/24",
		"18.236.0.0/15",
		"54.200.0.0/15",
		"64.252.72.0/24",
		"3.4.3.0/24",
		"52.94.249.64/28",
		"15.181.253.0/24",
		"70.224.192.0/18",
		"15.220.32.0/21",
		"54.245.0.0/16",
		"99.77.152.0/24",
		"35.160.0.0/13",
		"54.68.0.0/14",
		"54.212.0.0/15",
		"15.220.202.0/23",
		"142.4.160.64/29",
		"52.95.230.0/24",
		"99.77.253.0/24",
		"3.4.6.0/24",
		"15.220.208.128/26",
		"35.80.0.0/12",
		"15.220.200.0/23",
		"151.148.33.0/24",
		"52.12.0.0/15",
		"52.75.0.0/16",
		"54.218.0.0/16",
		"3.5.76.0/22",
		"15.181.0.0/20",
		"54.244.0.0/16",
		"44.224.0.0/11",
		"64.252.73.0/24",
		"52.95.255.112/28",
		"100.20.0.0/14",
		"15.220.0.0/20",
		"15.220.16.0/20",
		"193.57.170.0/23",
		"54.214.0.0/16",
		"34.208.0.0/12",
		"35.71.64.0/22",
		"18.34.244.0/22",
		"52.36.0.0/14",
		"15.220.226.0/24",
		"54.202.0.0/15",
		"15.181.128.0/20",
		"15.220.204.0/24",
		"96.0.110.0/23",
		"15.181.245.0/24",
		"52.95.247.0/24",
		"50.112.0.0/16",
		"15.181.64.0/20",
		"142.4.160.16/29",
		"52.94.116.0/22",
		"15.181.248.0/24",
		"15.253.0.0/16",
		"15.181.252.0/24",
		"52.46.180.0/22",
		"18.34.48.0/20",
		"15.181.16.0/20",
		"162.222.148.0/22",
		"52.24.0.0/14",
		"64.252.65.0/24",
		"192.157.33.0/24",
		"18.246.0.0/16",
		"3.5.80.0/21",
		"15.220.205.0/24",
		"52.88.0.0/15",
		"99.77.232.0/24",
		"142.4.160.104/29",
		"15.220.206.0/24",
		"15.177.80.0/24",
		"96.0.160.0/20",
		"99.151.186.0/23",
		"15.254.0.0/16",
		"52.40.0.0/14",
		"64.252.70.0/24",
		"18.88.128.0/18",
		"52.32.0.0/14",
		"3.33.42.0/24",
		"54.184.0.0/13",
		"142.4.160.96/29",
		"173.83.204.0/23",
		"15.181.251.0/24",
		"142.4.160.32/29",
		"64.252.71.0/24",
		"35.155.0.0/16",
		"52.10.0.0/15",
		"3.4.4.0/24",
		"15.181.116.0/22",
		"15.220.224.0/23",
		"15.181.250.0/24",
		"15.220.40.0/22",
		"52.94.248.96/28",
		"99.77.186.0/24",
	}

	cidrsEUWest1CIDRS = []string{
		"54.247.0.0/16",
		"18.200.0.0/16",
		"54.74.0.0/15",
		"52.95.255.64/28",
		"54.229.0.0/16",
		"3.2.34.128/26",
		"46.51.192.0/20",
		"63.32.0.0/14",
		"63.246.113.0/24",
		"52.30.0.0/15",
		"54.154.0.0/16",
		"52.95.244.0/24",
		"99.77.155.0/24",
		"70.232.124.0/22",
		"3.5.72.0/23",
		"54.216.0.0/15",
		"52.48.0.0/14",
		"162.213.232.0/24",
		"35.71.72.0/22",
		"52.208.0.0/13",
		"15.177.89.0/24",
		"79.125.0.0/17",
		"54.170.0.0/15",
		"64.252.117.0/24",
		"99.80.0.0/15",
		"173.83.214.0/24",
		"3.5.64.0/21",
		"54.220.0.0/16",
		"46.51.128.0/18",
		"99.151.88.0/21",
		"162.213.234.0/23",
		"18.201.0.0/16",
		"54.228.0.0/16",
		"195.17.0.0/24",
		"176.34.64.0/18",
		"208.86.90.0/23",
		"46.137.128.0/18",
		"54.78.0.0/16",
		"54.194.0.0/15",
		"15.177.75.0/24",
		"3.248.0.0/13",
		"99.77.133.0/24",
		"54.155.0.0/16",
		"52.16.0.0/15",
		"64.252.115.0/24",
		"18.202.0.0/15",
		"185.48.120.0/22",
		"54.76.0.0/15",
		"64.252.116.0/24",
		"34.240.0.0/13",
		"52.94.248.16/28",
		"54.72.0.0/15",
		"176.34.128.0/17",
		"34.248.0.0/13",
		"108.128.0.0/13",
		"64.252.114.0/24",
		"52.18.0.0/15",
		"151.148.34.0/24",
		"162.213.233.0/24",
		"54.246.0.0/16",
		"99.77.250.0/24",
		"46.137.0.0/17",
	}
)
